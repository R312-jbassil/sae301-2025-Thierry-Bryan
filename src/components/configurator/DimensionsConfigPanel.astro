---
// filepath: src/components/configurator/DimensionsConfigPanel.astro
import Button from "../ui/Button.astro";

export interface Props {
  price?: string;
}

const { price = "249‚Ç¨" } = Astro.props;
---

<!-- Section droite : Configuration Dimensions (4/5) -->
<div class="bg-white flex flex-col h-full border-l border-gray-100">
  <!-- Contenu scrollable -->
  <div class="flex-1 overflow-y-auto p-6">
    <!-- Header de la section -->
    <div class="flex items-center justify-between mb-6">
      <div>
        <h2 class="font-secondary text-xl font-medium text-gray-900 mb-1">Dimensions</h2>
        <p class="font-secondary text-sm text-gray-500">Ajustez la taille</p>
      </div>
      <div class="bg-gray-50 px-3 py-2 rounded-lg">
        <span class="text-gray-900 font-secondary font-semibold text-lg">{price}</span>
      </div>
    </div>

    <!-- Section Dimensions -->
    <div class="space-y-8">
      
      <!-- Largeur des verres -->
      <div class="bg-gray-50 rounded-xl p-6 border border-gray-200">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
              <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <rect x="3" y="6" width="18" height="12" rx="2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                <line x1="9" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="1"/>
                <line x1="15" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="1"/>
              </svg>
            </div>
            <div>
              <h3 class="font-secondary font-medium text-gray-900">Largeur des verres</h3>
              <p class="font-secondary text-sm text-gray-500">45mm - 60mm</p>
            </div>
          </div>
          <div class="bg-white px-4 py-2 rounded-lg border">
            <span class="font-secondary text-lg font-semibold text-gray-900" id="lens-width-value">52</span>
            <span class="font-secondary text-sm text-gray-500 ml-1">mm</span>
          </div>
        </div>
        
        <div class="px-2">
          <input
            type="range"
            id="lens-width"
            min="45"
            max="60"
            value="52"
            class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider-blue"
          />
          <div class="flex justify-between text-xs text-gray-400 mt-1">
            <span>45mm</span>
            <span>60mm</span>
          </div>
        </div>
      </div>

      <!-- Largeur du pont -->
      <div class="bg-gray-50 rounded-xl p-6 border border-gray-200">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-emerald-100 rounded-lg flex items-center justify-center">
              <svg class="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M9 12h6" stroke="currentColor" stroke-width="1.5"/>
                <circle cx="7" cy="12" r="2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                <circle cx="17" cy="12" r="2" stroke="currentColor" stroke-width="1.5" fill="none"/>
              </svg>
            </div>
            <div>
              <h3 class="font-secondary font-medium text-gray-900">Largeur du pont</h3>
              <p class="font-secondary text-sm text-gray-500">14mm - 22mm</p>
            </div>
          </div>
          <div class="bg-white px-4 py-2 rounded-lg border">
            <span class="font-secondary text-lg font-semibold text-gray-900" id="bridge-width-value">18</span>
            <span class="font-secondary text-sm text-gray-500 ml-1">mm</span>
          </div>
        </div>
        
        <div class="px-2">
          <input
            type="range"
            id="bridge-width"
            min="14"
            max="22"
            value="18"
            class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider-emerald"
          />
          <div class="flex justify-between text-xs text-gray-400 mt-1">
            <span>14mm</span>
            <span>22mm</span>
          </div>
        </div>
      </div>
      
    </div>


  </div>

  <!-- Boutons de navigation (toujours visibles) -->
  <div class="bg-white border-t border-gray-100 p-6">
    <div class="flex justify-between items-center">
      <button id="prev-step" class="flex items-center gap-2 text-gray-600 font-secondary text-sm transition-colors hover:text-gray-900">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        Pr√©c√©dent
      </button>
      
      <button id="next-step" class="flex h-10 px-6 items-center rounded-lg bg-gray-900 text-white font-secondary font-medium transition-all duration-200 hover:bg-gray-800 hover:shadow-md">
        Suivant
        <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </button>
    </div>
  </div>
</div>

<style>
  /* Styles personnalis√©s pour les sliders */
  .slider-blue::-webkit-slider-thumb {
    appearance: none;
    height: 20px;
    width: 20px;
    border-radius: 50%;
    background: #2563eb;
    border: 3px solid #ffffff;
    box-shadow: 0 2px 6px rgba(37, 99, 235, 0.3);
    cursor: pointer;
  }

  .slider-blue::-moz-range-thumb {
    height: 20px;
    width: 20px;
    border-radius: 50%;
    background: #2563eb;
    border: 3px solid #ffffff;
    box-shadow: 0 2px 6px rgba(37, 99, 235, 0.3);
    cursor: pointer;
  }

  .slider-emerald::-webkit-slider-thumb {
    appearance: none;
    height: 20px;
    width: 20px;
    border-radius: 50%;
    background: #059669;
    border: 3px solid #ffffff;
    box-shadow: 0 2px 6px rgba(5, 150, 105, 0.3);
    cursor: pointer;
  }

  .slider-emerald::-moz-range-thumb {
    height: 20px;
    width: 20px;
    border-radius: 50%;
    background: #059669;
    border: 3px solid #ffffff;
    box-shadow: 0 2px 6px rgba(5, 150, 105, 0.3);
    cursor: pointer;
  }
</style>

<script>
  // Gestion des dimensions
  document.addEventListener("DOMContentLoaded", () => {
    const lensWidthSlider = document.querySelector(
      "#lens-width"
    ) as HTMLInputElement;
    const bridgeWidthSlider = document.querySelector(
      "#bridge-width"
    ) as HTMLInputElement;

    const lensWidthValue = document.querySelector("#lens-width-value");
    const bridgeWidthValue = document.querySelector("#bridge-width-value");

    // Fonction pour mettre √† jour les valeurs affich√©es
    function updateValues() {
      if (lensWidthValue)
        lensWidthValue.textContent = lensWidthSlider.value;
      if (bridgeWidthValue)
        bridgeWidthValue.textContent = bridgeWidthSlider.value;
    }

    // Gestion des sliders
    [lensWidthSlider, bridgeWidthSlider].forEach((slider) => {
      if (slider) {
        slider.addEventListener("input", () => {
          updateValues();

          // Dispatch d'un √©v√©nement pour les changements de dimensions
          window.dispatchEvent(
            new CustomEvent("dimensionChange", {
              detail: {
                type: slider.id === 'lens-width' ? 'lens-width' : 'bridge-width',
                value: parseInt(slider.value),
                lensWidth: parseInt(lensWidthSlider.value),
                bridgeWidth: parseInt(bridgeWidthSlider.value)
              },
            })
          );
        });
      }
    });

    // Initialiser les valeurs
    updateValues();

    // √âcouter l'√©v√©nement de chargement d'une cr√©ation existante
    window.addEventListener('loadExistingCreation', (e) => {
      const customEvent = e as CustomEvent;
      const lunette = customEvent.detail;
      console.log('üìù DimensionsConfigPanel: Chargement de la cr√©ation existante:', lunette);

      // Charger les dimensions
      if (lunette.taille_verres) {
        lensWidthSlider.value = lunette.taille_verres.toString();
      }
      if (lunette.largeur_pont) {
        bridgeWidthSlider.value = lunette.largeur_pont.toString();
      }
      
      // Mettre √† jour l'affichage
      updateValues();
      
      // Dispatcher les √©v√©nements de changement pour synchroniser
      window.dispatchEvent(
        new CustomEvent("dimensionChange", {
          detail: {
            type: 'both',
            lensWidth: parseInt(lensWidthSlider.value),
            bridgeWidth: parseInt(bridgeWidthSlider.value)
          },
        })
      );
    });
  });
</script>
