---
// filepath: src/components/configurator/ConfigPanel.astro
import Button from "../ui/Button.astro";

export interface Props {
  price?: string;
}

const { price = "249‚Ç¨" } = Astro.props;
---

<!-- Section droite : Configuration Forme & Mat√©riau (1/3) -->
<div class="bg-gray-50 flex flex-col h-full">
  
  <!-- Contenu scrollable -->
  <div class="flex-1 overflow-y-auto p-4">
    
    <!-- Header de la section -->
    <div class="flex items-center justify-between mb-4">
      <div>
        <h2 class="font-primary text-lg text-[#003366] mb-1">Votre Mod√®le Personnalis√©</h2>
        <p class="font-secondary text-gray-600 text-xs">Fabrication Fran√ßaise</p>
      </div>
      <div class="text-[#003366] font-secondary font-bold text-base">
        {price}
      </div>
    </div>

    <!-- Barre de s√©paration -->
    <div class="h-px bg-gray-200 mb-4"></div>

    <!-- Section Mat√©riau Monture -->
    <div class="mb-4">
      <h3 class="font-secondary font-semibold text-[#003366] mb-3">Mat√©riau Monture</h3>
      
      <div class="grid grid-cols-1 gap-3">
        <!-- Ac√©tate Artisanal (s√©lectionn√©) -->
        <button class="material-btn flex h-12 px-4 items-center rounded-[14px] bg-[#003366] text-white font-secondary font-medium transition-colors duration-300 hover:bg-[#830000]" data-material-id="1" data-material-name="Ac√©tate Artisanal">
          Ac√©tate Artisanal
        </button>
        
        <!-- M√©tal L√©ger -->
        <button class="material-btn flex h-12 px-4 items-center rounded-[14px] bg-white border-2 border-gray-200 text-gray-600 font-secondary font-medium transition-colors duration-300 hover:border-[#003366] hover:text-[#003366]" data-material-id="2" data-material-name="M√©tal L√©ger">
          M√©tal L√©ger
        </button>
        
        <!-- Bois Lamin√© -->
        <button class="material-btn flex h-12 px-4 items-center rounded-[14px] bg-white border-2 border-gray-200 text-gray-600 font-secondary font-medium transition-colors duration-300 hover:border-[#003366] hover:text-[#003366]" data-material-id="3" data-material-name="Bois Lamin√©">
          Bois Lamin√©
        </button>
      </div>
    </div>

    <!-- Section Couleur Monture -->
    <div class="mb-4">
      <h3 class="font-secondary font-semibold text-[#003366] mb-3">Couleur Monture</h3>
      <div class="flex gap-3 justify-start">
        <!-- Couleurs disponibles -->
        <button 
          data-color="#000000" 
          class="color-btn w-12 h-12 bg-black rounded-full border-4 border-[#003366] transition-transform hover:scale-110"
        ></button>
        <button 
          data-color="#b45309" 
          class="color-btn w-12 h-12 bg-amber-700 rounded-full border-2 border-gray-200 transition-all hover:scale-110 hover:border-[#003366]"
        ></button>
        <button 
          data-color="#003366" 
          class="color-btn w-12 h-12 bg-[#003366] rounded-full border-2 border-gray-200 transition-all hover:scale-110 hover:border-[#003366]"
        ></button>
        <button 
          data-color="#830000" 
          class="color-btn w-12 h-12 bg-[#830000] rounded-full border-2 border-gray-200 transition-all hover:scale-110 hover:border-[#003366]"
        ></button>
        <button 
          data-color="#15803d" 
          class="color-btn w-12 h-12 bg-green-700 rounded-full border-2 border-gray-200 transition-all hover:scale-110 hover:border-[#003366]"
        ></button>
      </div>
    </div>

  </div>

  <!-- Boutons de navigation (toujours visibles) -->
  <div class="bg-gray-50 border-t border-gray-200 p-4">
    <div class="flex justify-between items-center">
      <button id="prev-step" class="flex items-center gap-2 text-[#003366] font-secondary transition-colors hover:text-[#830000] opacity-50 cursor-not-allowed">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        Pr√©c√©dent
      </button>
      
      <button id="next-step" class="flex h-12 px-6 items-center rounded-[14px] bg-[#003366] text-white font-secondary font-medium transition-colors duration-300 hover:bg-[#830000]">
        Suivant
      </button>
    </div>
  </div>

</div>

<script>
  // Gestion du changement de mat√©riau et couleur de la monture
  document.addEventListener('DOMContentLoaded', () => {
    const colorButtons = document.querySelectorAll('.color-btn');
    const materialButtons = document.querySelectorAll('.material-btn');
    
    // Gestion des mat√©riaux
    materialButtons.forEach(button => {
      button.addEventListener('click', () => {
        const materialId = button.getAttribute('data-material-id');
        const materialName = button.getAttribute('data-material-name');
        
        // Mise √† jour de l'interface
        materialButtons.forEach(btn => {
          btn.classList.remove('bg-[#003366]', 'text-white');
          btn.classList.add('bg-white', 'border-2', 'border-gray-200', 'text-gray-600');
        });
        
        button.classList.remove('bg-white', 'border-2', 'border-gray-200', 'text-gray-600');
        button.classList.add('bg-[#003366]', 'text-white');
        
        // Dispatch d'un √©v√©nement personnalis√©
        window.dispatchEvent(new CustomEvent('materialChange', { 
          detail: { materialId: materialId, materialName: materialName } 
        }));
      });
    });
    
    // Gestion des couleurs
    colorButtons.forEach(button => {
      button.addEventListener('click', () => {
        const selectedColor = button.getAttribute('data-color');
        
        // Mise √† jour de l'interface
        colorButtons.forEach(btn => {
          btn.classList.remove('border-4', 'border-[#003366]');
          btn.classList.add('border-2', 'border-gray-200');
        });
        
        button.classList.remove('border-2', 'border-gray-200');
        button.classList.add('border-4', 'border-[#003366]');
        
        // Mise √† jour de la couleur du SVG
        document.documentElement.style.setProperty('--frame-color', selectedColor);
        
        // Dispatch d'un √©v√©nement personnalis√© pour d'autres composants
        window.dispatchEvent(new CustomEvent('frameColorChange', { 
          detail: { color: selectedColor } 
        }));
      });
    });

    // √âcouter l'√©v√©nement de chargement d'une cr√©ation existante
    window.addEventListener('loadExistingCreation', (e) => {
      const customEvent = e as CustomEvent;
      const lunette = customEvent.detail;
      console.log('üìù ConfigPanel: Chargement de la cr√©ation existante:', lunette);

      // Charger la couleur de la monture
      if (lunette.couleur_monture) {
        const colorButton = document.querySelector(`[data-color="${lunette.couleur_monture}"]`) as HTMLElement;
        if (colorButton) {
          colorButton.click(); // Simuler un clic pour activer la couleur
        }
      }

      // Charger le mat√©riau si disponible
      if (lunette.expand?.id_materiau?.libelle) {
        const materialButton = document.querySelector(`[data-material-name="${lunette.expand.id_materiau.libelle}"]`) as HTMLElement;
        if (materialButton) {
          materialButton.click(); // Simuler un clic pour activer le mat√©riau
        }
      }
    });
  });
</script>