---
// filepath: src/components/configurator/ProgressBar.astro
export interface Props {
  currentStep?: number;
}

const { currentStep = 1 } = Astro.props;

const steps = [
  { id: 1, label: "Forme & Matériau" },
  { id: 2, label: "Branches" },
  { id: 3, label: "Verres" },
  { id: 4, label: "Dimensions" },
  { id: 5, label: "Actions" }
];
---

<!-- Barre de progression moderne -->
<div class="bg-white border-b border-gray-100 px-6 py-4">
  <div class="max-w-4xl mx-auto">
    <div class="flex items-center justify-between" id="progress-bar">
      {steps.map((step, index) => (
        <>
          <!-- Étape -->
          <div class="flex flex-col items-center min-w-0 flex-1">
            <div class={`step-indicator flex items-center justify-center w-8 h-8 rounded-xl font-secondary font-semibold text-sm transition-all duration-300 mb-2`}
                 data-step={step.id}>
              {step.id}
            </div>
            <span class={`step-label font-secondary text-xs transition-all duration-300 text-center leading-tight`}
                  data-step={step.id}>
              {step.label}
            </span>
          </div>
          
          <!-- Ligne de connexion (sauf pour le dernier) -->
          {index < steps.length - 1 && (
            <div class="step-connector flex-1 h-0.5 mx-4 rounded-full transition-all duration-300 -mt-5" 
                 data-step={step.id}></div>
          )}
        </>
      ))}
    </div>
  </div>
</div>

<script>
  // Fonction pour mettre à jour l'apparence de la barre de progression
  function updateProgressBar(currentStep: number) {
    const stepIndicators = document.querySelectorAll('.step-indicator');
    const stepLabels = document.querySelectorAll('.step-label');
    const stepConnectors = document.querySelectorAll('.step-connector');

    stepIndicators.forEach((indicator) => {
      const stepId = parseInt(indicator.getAttribute('data-step') || '0');
      
      if (stepId === currentStep) {
        // Étape active
        indicator.classList.remove('bg-gray-200', 'text-gray-500', 'bg-gray-800', 'text-white');
        indicator.classList.add('bg-gray-900', 'text-white', 'shadow-lg');
      } else if (stepId < currentStep) {
        // Étape complétée
        indicator.classList.remove('bg-gray-200', 'text-gray-500', 'bg-gray-900', 'shadow-lg');
        indicator.classList.add('bg-gray-800', 'text-white');
      } else {
        // Étape non atteinte
        indicator.classList.remove('bg-gray-800', 'text-white', 'bg-gray-900', 'shadow-lg');
        indicator.classList.add('bg-gray-200', 'text-gray-500');
      }
    });

    stepLabels.forEach((label) => {
      const stepId = parseInt(label.getAttribute('data-step') || '0');
      
      if (stepId === currentStep) {
        // Étape active
        label.classList.remove('text-gray-500', 'text-gray-800');
        label.classList.add('text-gray-900', 'font-semibold');
      } else if (stepId < currentStep) {
        // Étape complétée
        label.classList.remove('text-gray-500', 'text-gray-900', 'font-semibold');
        label.classList.add('text-gray-800', 'font-medium');
      } else {
        // Étape non atteinte
        label.classList.remove('text-gray-800', 'text-gray-900', 'font-semibold', 'font-medium');
        label.classList.add('text-gray-500');
      }
    });

    // Animer les connecteurs
    stepConnectors.forEach((connector) => {
      const stepId = parseInt(connector.getAttribute('data-step') || '0');
      
      if (stepId < currentStep) {
        connector.classList.remove('bg-gray-200');
        connector.classList.add('bg-gray-800');
      } else {
        connector.classList.remove('bg-gray-800');
        connector.classList.add('bg-gray-200');
      }
    });
  }

  // Initialisation
  document.addEventListener('DOMContentLoaded', () => {
    // Initialiser avec l'étape 1
    updateProgressBar(1);

    // Écouter les changements d'étapes
    window.addEventListener('stepChange', (e) => {
      const event = e as CustomEvent;
      updateProgressBar(event.detail.currentStep);
    });
  });
</script>